/*
 * Copyright (c) 2016 IBM Corporation.
 *
 * Unit Testing Framework
 *
 */

import Std::Core
import Std::String
import Std::Listdef
import Std::Language

enum Test | TestCase(Bool)
          | TestSuite( List<Test> )

/* Assertion functions */
func Assert<a>(#msg: String, #expected: a, #actual: a) -> Bool
→ If( Equal(#expected, #actual),
      ()->TRUE,
      ()->Error(ConcatString(#msg, ConcatString(": expected   ", ConcatString(PrintTerm("", #expected), ConcatString(" but got ", PrintTerm("", #actual)))))))

/* Run test(s) */
func RunTest(Test) -> Bool
rule RunTest(TestCase(#test))    → Eval<Bool>(#test)
rule RunTest(TestSuite(#tests))  → FoldlP( (x y) -> And(y, RunTest(x)), TRUE, #tests )

/* Main driver */
func MainTest(#test: Test) -> Numeric → If(RunTest(#test), ()->0, ()->1)
